---
title: "Homework 3"
author: Sarah McLarnan
date: 2019-10-07
output: github_document
---

### Problem 1
```{r setup, include=FALSE}
library(tidyverse)
library(viridis)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

```{r problem_1_data_load}
library(p8105.datasets)
data("instacart")
```
The `instacart` data set has `r nrow(instacart)` observations of `r ncol(instacart)` metrics. Each row corresponds to a single item in an order. The columns contain information including the item ordered (`product_id`, `product_name`), the department (`department_id`, `department`) and aisle (`aisle_id`, `aisle`) it is from, the day of the week (`order_dow`) and time (`order_hour_of_day`) it was ordered, the order in which the item was added to the order (`add_to_cart_order`) in addition to other metrics. For example the first item in the table is Bulgarian Yogurt from the yogurt aisle in the dairy and eggs department. The item was ordered at 10 a.m. on a Wednesday, it was the first item the shopper added to their order and it had been 9 days since that shopper's previous order. 

```{r problem_1_aisles}
n_distinct(pull(instacart, aisle_id))

instacart %>%
  group_by(aisle) %>%
  summarize(n = n()) %>%
  mutate(aisle_rank = rank(desc(n))) %>%
  filter(aisle_rank <= 3)
```
There are 134 aisles. The top three aisles with the most products ordered from are fresh vegetables, fresh fruits, and packaged vegetables and fruits. 

```{r problem_1_aisle_graph}
instacart %>%
  group_by(aisle) %>%
  summarize(n = n()) %>%
  filter(n > 10000) %>%
  ggplot(aes(x = aisle, y = n)) + 
  geom_col() +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = "Aisle", y = "Number of Products Ordered", title = "Number of Products Ordered from Aisle")
```
```{r problem_1_product_table}
instacart %>%
  group_by(aisle, product_name) %>%
  summarize(n = n()) %>%
  mutate(product_rank = rank(desc(n))) %>%
  filter(product_rank <= 3) %>%
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>%
  arrange(aisle, product_rank) %>%
  knitr::kable()
```
```{r problem_1_product_time}
instacart %>%
  filter(product_name == "Coffee Ice Cream" | product_name == "Pink Lady Apples") %>%
  group_by (order_dow, product_name) %>%
  summarize (mean_time = mean(order_hour_of_day)) %>%
  pivot_wider (names_from = order_dow, values_from = mean_time) %>%
  knitr::kable()
```
### Problem 2
```{r problem_2_data_clean}
data("brfss_smart2010")

brfss_smart2010 = 
  brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  filter(response == "Excellent" | response == "Very good" | response == "Good" | response == "Fair" | response == "Poor") %>%
  mutate(response = factor(response), 
         response = forcats::fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))) 
```
```{r problem_2_multiple_location}
brfss_smart2010 %>%
  filter(year == "2002") %>%
  group_by(locationabbr) %>%
  summarize(unique_location = length(unique(locationdesc))) %>%
  filter(unique_location >= 7)

brfss_smart2010 %>%
  filter(year == "2010") %>%
  group_by(locationabbr) %>%
  summarize(unique_location = length(unique(locationdesc))) %>%
  filter(unique_location >= 7)
```
```{r problem_2_state_graph}
brfss_smart2010 %>%
  filter(response == "Excellent") %>%
  group_by(locationabbr, year) %>%
  summarize(data_value_mean = mean(data_value)) %>%
  ggplot(aes(x = year, y = data_value_mean, group = locationabbr, color = locationabbr)) +
  geom_line() +
  labs(
        x = "Year", 
        y = "Mean Data Value", 
        title = "Mean Data Value for Excellent Responses by Year for U.S. States"
      )
```
```{r problem_2_NY_graph}
brfss_smart2010 %>%
  filter(locationabbr == "NY", year == "2006" | year == "2010") %>%
  ggplot(aes(x = response, y = data_value)) +
        geom_col() +
        facet_grid(~year) +
        labs(x = "Response", y = "Data Value", title = "Data Value by Response at NY locations in 2006 and 2010")
```
```{r problem_3_data_tidy}
accel_data = read_csv("./data/accel_data.csv") 

accel_data = pivot_longer(accel_data, activity.1:activity.1440, names_to = "activity_minute", values_to = "activity_count") %>%
  separate(activity_minute, into = c("activity", "minute")) %>%
  select(-activity) %>%
  mutate(
    minute = as.numeric(minute),
    day = as.factor(day),
    day = forcats::fct_relevel(day, c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")),
    day_type  = if_else(day == "Saturday" | day == "Sunday", "weekend", "weekday"))
```
```{r problem_3_activity_count}
accel_data %>%
  group_by(day_id) %>%
  summarize(total_activity = sum(activity_count)) %>%
  knitr::kable()
```




